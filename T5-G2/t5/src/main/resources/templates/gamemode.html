<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/t5/css/Css/gamemode_marco.css"/>
    <title>Choose Your Enemy</title>

    <!-- Link ai CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>
    <!-- Inclusione jQuery -->
    <script th:src="@{/t5/jquery/jquery-3.7.0.com.js}"  th:inline="javascript"> </script>

    <div class="container mt-5">
        <div class="row mb-4 align-items-center">
            <div class="col text-start">
                <p class="user_position_main" style="color: black; margin-bottom: 0;">Username: <span id="usernameField"></span></p>
            </div>
            <div class="col-auto">
                <button id="logoutButton" type="button" class="btn btn-custom btn-sm" onclick="redirectToLogin()">Logout</button>
            </div>
        </div>
    
        <div class="text-center mb-4">
            <h3 id="selectedMode" class="text-custom">Modalità Selezionata:</h3>
        </div>

        <div class="container mt-5">
            <h2>Seleziona un'opzione</h2>
            <form>
                <div class="form-group">
                    <label for="select1">Seleziona la Classe UT:</label>
                    <select class="form-control" id="select_class">
                        <option value="">Seleziona un'opzione</option>
                        <th:block th:each="option : ${lista_classi}">
                            <option th:value="${option.name}" th:text="${option.name}"></option>
                        </th:block>
                    </select>
                </div>
    
                <div class="form-group">
                    <label for="select2">Seleziona il Robot:</label>
                    <select class="form-control" id="select_robot">
                        <option value="">Seleziona un'opzione</option>
                        <th:block th:each="option : ${lista_robot}">
                            <option th:value="${option}" th:text="${option}"></option>
                        </th:block>
                    </select>
                </div>

                <div class="form-group">
                    <label for="select2">Seleziona la difficoltà:</label>
                    <select class="form-control" id="select_diff">
                        <option value="">Seleziona un'opzione</option>
                        <option value="1">Easy</option>
                        <option value="2">Medium</option>
                        <option value="3">Hard</option>
                    </select>
                </div>

               <div class="form-group pt-2">
                    <a id="link_editor" class="btn btn-primary" href="#" role="button">Link</a>
                </div>

            </form>
        </div>
    </div>

    <script>
        // Funzione per ottenere i parametri dall'URL
        function getParameterByName(name) {
            const url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&'); // Escape special characters
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null; // Parametro non trovato
            if (!results[2]) return ''; // Parametro presente ma senza valore
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Ottieni il parametro "mode" dall'URL e aggiornalo nell'elemento
        window.addEventListener('load', function() {
            const mode = getParameterByName('mode');
            if (mode) {
                document.getElementById('selectedMode').textContent += ' ' + mode.replace(/[^a-zA-Z0-9\s]/g, ' '); // Aggiungi il valore al testo
            }
            localStorage.setItem('modalita', mode);
        });

        // Funzione per salvare i valori nel localStorage
        function saveToLocalStorage() {
            const select1Value = document.getElementById('select_class').value;
            const select2Value = document.getElementById('select_robot').value;
            const select3Value = document.getElementById('select_diff').value;

            // Salva i valori nel localStorage
            localStorage.setItem('underTestClassName', select1Value);
            localStorage.setItem('robot', select2Value);
            localStorage.setItem('difficulty', select3Value);

            // Seleziona l'elemento <a> tramite l'ID
            let link = document.getElementById("link_editor");
            // Imposta l'attributo href
            link.setAttribute("href", "/editor?ClassUT=" + select1Value);
        }

        // Aggiungi gli event listener per salvare i valori quando cambia la selezione
        document.getElementById('select_class').addEventListener('change', saveToLocalStorage);
        document.getElementById('select_robot').addEventListener('change', saveToLocalStorage);
        document.getElementById('select_diff').addEventListener('change', saveToLocalStorage);
    </script>

</body>

</html>
